<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>网易云音乐</title>
    <meta name="Author" content="lily">
    <meta name="Keywords" content="">
    <meta name="Description" content="">
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div id="my" class="my">
        <div id="my_hi" class="my_hi"></div>
        <header>
            <img src="https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=2248627470,1311224484&fm=179&app=42&f=JPEG?w=56&h=56" />
            <span class="h_wy">网易云音乐</span>
            <input id="h_se" class="h_se" type="search" placeholder="搜索音乐" />
            <span class="fa fa-user-circle-o fa-1g color_user"></span><span id="h_login" class="h_login">登录</span>
            <span class="fa fa-adjust fa-1g color_skin"></span><span id="h_skin" class="h_skin">皮肤 <input type="color" id="color" value="#c62f2f" oninput="skinChange()"></span>
            <div id="h_dl" class="h_dl">
                <span id="h_hide" class="fa fa-times fa-1g color_login"></span>
                <h3>用户登录</h3>
                <ul>
                    <li><input class="in" type="text" id="name" name="name" placeholder="用户名" required/></li>
                    <li><input class="in" type="password" id="pwd" name="pwd" placeholder="密码" required/></li>
                    <li class="ch"><input type="checkbox">记住密码</li>
                    <li><button id="form_login" class="form_login">登录</button></li>
                </ul>
            </div>
        </header>
        <section>
            <div class="s_top">
                <aside id="t_left">
                    <img id="l_pic" class='l_pic' src='http://img004.file.rongbiz.cn/uploadfile/201708/31/13/13-36-19-83-912065.jpg' alt='旋转图片' />
                    <ul>
                        <li><button type='button' class='fa fa-heart-o fa-1g'>喜欢</button></li>
                        <li><button type='button' class='fa fa-folder-o fa-1g'>收藏</button></li>
                        <li><button type='button' class='fa fa-download fa-1g' id="myload">下载</button></li>
                        <li><button type='button' class='fa fa-share-square-o fa-1g'>分享</button></li>
                        <div class='clear'></div>
                    </ul>
                </aside>
                <article id="t_right">
                    <h2>song</h2>
                    <span>专辑：<b class='ms'>album</b></span>
                    <span>歌手：<b class='ms'>singer</b></span>
                    <span>专辑：<b class='ms'>source</b></span>
                    <ul id='lrc' class='lrc'></ul>
                </article>
                <div class="clear"></div>
            </div>
            <hr style="width: 80%;margin: 0 auto;"/>
            <div class="s_bottom">
                <h3>听友评论</h3>
                <span id="sum" class="sum">(已有<b>0</b>条评论)</span>
                <form action="#">
                    <input type="text" placeholder="发表评论" onclick="putComment()"/>
                </form>
                <div id="f_dl" class="f_dl">
                    <h3></h3>
                    <span id="f_hide" class="fa fa-times fa-1g f_p"></span>
                    <ul>
                        <li><textarea></textarea></li>
                        <li><button id="f_pl" class="f_pl">评论</button></li>
                    </ul>
                </div>
                <p>精彩评论</p>
                <ul id="msg" class="msg"></ul>
            </div>
        </section>
        <footer>
            <span class="fa fa-chevron-circle-left fa-2x play" id="preplay"></span>
            <span class="fa fa-play-circle fa-2x play" id="myplay"></span>
            <span class="fa fa-chevron-circle-right fa-2x play" id="nextplay"></span>
            <div class="all">
                <b id="a_start">00:00</b>
                <div class="a_now" id="a_now">
                    <span id="curtime" class="curtime"></span>
                    <span id="curall" class="curall"></span>
                </div>
                <b id="a_end">00:00</b>
            </div>
           <span id="color_voice" class="fa fa-bell-o fa-1g color_voice"></span>
           <input type="range" id="volume" class="volume" min="0" max="1" step="0.001" oninput="chooseVolume()" value="0.2">
           <span class="fa fa-reorder (alias) fa-1g mode" id="mode" title="顺序播放"></span>
           <span class="fa fa-linkedin-square fa-1g mylyric" id="mylyric" title="歌词"></span>
           <span class="fa fa-wpforms fa-1g mylist" id="mylist" title="打开播放列表"></span><span class="dig" id="dig">1</span>
           <div class="showlyric" id="showlyric"></div>
           <div class="showlist" id="showlist">
               <div id="show" class="show"><span class="l">播放列表</span><span class="r">历史记录</span></div>
               <div id="s">
                   <div id="play" class="oplay">
                       <h4><span>总共<b>10</b>首</span><span id="oclear_1">清空</span></h4>
                       <ul></ul>
                   </div>
                   <div id="history" class="history">
                       <h4><span>总共<b>0</b>首</span><span id="oclear_2">清空</span></h4>
                       <ul></ul>
                   </div>
               </div>
           </div>
        </footer>
        <br><div id="audio" style="display: none;"></div>
    </div>
</body>
<script src="http://libs.baidu.com/jquery/1.7.2/jquery.js"></script>
<script src="lrc.js"></script>
<script>
    var data=[
        {"id":"1","song": "江南","album": "第二天堂","singer": "林俊杰","source": "搜索页","url": "music/jn.mp3","cover": "http://p1.music.126.net/2diP5uOrailFol-qgmprUQ==/109951163243492839.jpg","lyric": "jn","love": "0","msg": [{"megId":1,"megCon":"还依稀记得，04年。大学毕业后的第一份实习工作。手机还不支持MP3 播放，一个同事小姑娘说想听《江南》，当时这首歌超火。于是哥们我就拿单位座机打我自己手机，不接，因为我当时的手机彩铃就是《江南》，就这样一遍遍打，一遍遍听…","date":"2018-08-01 14:36:02","userId":"1"},{"megId":2,"megCon":"怀念那个年代，江南，童话，波斯猫…","date":"2018-08-11 08:10:05","userId":"2"}]},
        {"id":"2","song": "他不懂","album": "爱，不解释","singer": "张杰","source": "搜索页","url": "music/tbd.mp3","cover": "http://p1.music.126.net/mW53BkMgGy37I7yVrUg-aQ==/109951163117902077.jpg","lyric": "tbd","love": "0","msg": [{"megId":1,"megCon":"听的也想哭，老了，你们还好吗？","date":"2018-08-01 14:36:02","userId":"2"},{"megId":2,"megCon":"在微博看过一个视频，张杰正好在逛街，遇到一个街边唱歌的人，唱的就是江南，林俊杰走上前与他合唱了。暖心","date":"2018-08-11 08:10:05","userId":"3"}]},
        {"id":"3","song": "我们都一样","album": "Chance","singer": "张杰","source": "搜索页","url": "music/wmdyy.mp3","cover":"http://p1.music.126.net/k5IeL8ko8cx0QsumpecTrA==/109951163076339407.jpg","lyric": "wmdyy","love": "0","msg": [{"megId":1,"megCon":"想起了抄歌词的那个年代","date":"2018-08-01 14:36:02","userId":"3"},{"megId":2,"megCon":"那时候很多人用复读机，好怀念。","date":"2018-08-11 08:10:05","userId":"4"}]},
        {"id":"4","song": "有何不可","album": "自定义","singer": "许嵩","source": "搜索页","url": "music/yhbk.mp3","cover": "http://p1.music.126.net/Md3RLH0fe2a_3dMDnfqoQg==/18590542604286213.jpg","lyric": "yhbk","love": "0","msg": [{"megId":1,"megCon":"那时候还是借同学MP3听的。。。","date":"2018-08-01 14:36:02","userId":"4"},{"megId":2,"megCon":"有人在2016听吗？举个爪（我是来回忆的）","date":"2018-08-11 08:10:05","userId":"1"}]}
    ];
    var users=[
        {"id":"1","name":"紫雪凝梦","pwd":"123456","pic":"http://p1.music.126.net/2diP5uOrailFol-qgmprUQ==/109951163243492839.jpg"},
        {"id":"2","name":"小柠檬","pwd":"123456","pic":"http://p1.music.126.net/mW53BkMgGy37I7yVrUg-aQ==/109951163117902077.jpg"},
        {"id":"3","name":"果果","pwd":"123456","pic":"http://p1.music.126.net/k5IeL8ko8cx0QsumpecTrA==/109951163076339407.jpg"},
        {"id":"4","name":"一笑奈何","pwd":"123456","pic":"http://p1.music.126.net/Md3RLH0fe2a_3dMDnfqoQg==/18590542604286213.jpg"}
    ];

    //显示登录框
    $("#h_login").click(function() {
        $("#h_dl").toggle();
        $("#my_hi").toggle();
    });
    //关闭登录框
    $("#h_hide").click(function() {
        $("#h_dl").hide();
        $("#my_hi").hide();
    });
    //更换皮肤
    function skinChange() {
        $("header").css("background", $("#color").val());
        $("footer").css("background", $("#color").val());
    }

    var activeUser=0;

    //ajax兼容性写法
    var xmlhttp;
    function creatxhr() {
        if(window.ActiveXObject){
            xmlhttp= new ActiveXObject("Microsoft.XMLHTTP");
        }else {
            xmlhttp= new XMLHttpRequest();
        }
        return xmlhttp;
    }
    console.log(creatxhr());

    //用户登录
    $("#form_login").click(function() {
        var str = "";
        var name=$("#name").val();
        var pwd =$("#pwd").val();
        var tmp=0;
        for(var i=0; i<users.length; i++){
            if(name==users[i].name){
                tmp++;
                if(pwd==users[i].pwd){
                    activeUser = i;
                    tmp++;
                    //$("#h_login").html(name);
                    str = "name="+name+"&pwd="+pwd;
                }
            }
        }
        if(tmp==0) {
            alert("该用户名不存在")
        }
        if(tmp==1) {
            alert("密码输入错误")
        }
        if(tmp==2) {
            //异步登录
            var url= "http://www.coolneng.com/form/?"+str;
            xmlhttp.onreadystatechange=function() {
                //判断当前的状态
                console.log("监听：",xmlhttp.readyState,xmlhttp.status);
                //判断异步请求的准备状态，及网络状态
                if(xmlhttp.readyState==4 && xmlhttp.status==200){
                    //回调数据，转化为JSON格式
                    var formjson=JSON.parse(xmlhttp.responseText);

                    if(formjson.content==false) {
                        alert("用户提交的是一个空数据");
                    } else {
                        //数据处理输出
                        $("#h_login").html(formjson.content.name);
                        $("#h_dl").hide();
                        $("#my_hi").hide();
                    }
                }
            }
            //数据传输  第三个参数 如果是TRUE异步
            xmlhttp.open("POST",url,true);
            //请求头
            xmlhttp.setRequestHeader("content-Type","application/x-www-form-urlencoded");
            // 发送请求
            xmlhttp.send(url);
        }
    });

    //键盘监听事件
    $(window).keydown(function (res) {
        // 键盘输出当前按键，及编码
        //console.log(res.key,res.keyCode)
        if(res.keyCode==13){ //回车判断
            //执行发送函数
            var search = $("#h_se").val();
            for(var i=0; i<data.length; i++){
                if(search==data[i].song){
                    alert(search);
                }
            }
        }
    });

    var activeNum=0;

    //歌曲播放与暂停
    $("#audio").append("<audio controls id='myaudio' src='"+data[activeNum].url+"'></audio>");
    var omyaudio=document.getElementById("myaudio");

    function nowPlay() {
        omyaudio.play();
        setcookie(data[activeNum].song, data[activeNum].singer, 7);
        chageStyle();
    }

    function nowPause() {
        omyaudio.pause();
    }

    $("#myplay").click(function(){
        playMusic();
    });

    //播放与暂停按钮切换
    var notPlay = 0;

    function playMusic() {
        //var oname = $("#myplay")[0].className;
        //console.log(oname);
        if (0 == notPlay) {
            $("#myplay").removeClass("fa fa-play-circle fa-2x play");
            $("#myplay").addClass("fa fa-pause-circle-o fa-2x play");
            nowPlay();
            startMusic();
            startXz();
            notPlay = 1;
            getcookie();
        } else if (1==notPlay) {
            $("#myplay").removeClass("fa fa-pause-circle-o fa-2x play");
            $("#myplay").addClass("fa fa-play-circle fa-2x play");
            nowPause();
            stopXz();
            notPlay = 0;
        }
    }

    function startMusic() {
        $("#l_pic").attr("src", data[activeNum].cover);
        getLrc();
        getMessage();
    }

    function startXz() {
        $("#l_pic").addClass("xz");
    }

    function stopXz() {
        $("#l_pic").removeClass("xz");
    }

    //获取歌词
    function getLrc() {
        $("#t_right h2").html(data[activeNum].song);
        $("#t_right b:eq(0)").html(data[activeNum].album);
        $("#t_right b:eq(1)").html(data[activeNum].singer);
        $("#t_right b:eq(2)").html(data[activeNum].source);

        $("#lrc").html("");
        for(var i=0;i<lrcs.length;i++){
            if(data[activeNum].lyric==lrcs[i].song){
                for(var j=0;j<lrcs[i].lyric.length;j++) {
                    $("#lrc").append("<li data-time='"+lrcs[i].lyric[j].time+"'>"+lrcs[i].lyric[j].lineLyric+"</li>");
                }
            }
        }
    }

    var onow=document.getElementById("a_now");
    //播放监听：监听时间线发生改变
    omyaudio.ontimeupdate=function() {
        //时间部分
        var m = timeChange(parseInt(Math.ceil(omyaudio.currentTime)/60));
        var s = timeChange(parseInt(Math.ceil(omyaudio.currentTime)%60));
        var t = m+":"+s;
        document.getElementById("a_start").innerText=t;

        //进度条部分
        var temp=omyaudio.currentTime/omyaudio.duration*(onow.offsetWidth-16); //已播放进度条宽度
        $("#curtime").css("width", temp);
        $("#curall").css("left", temp);//前进的小球

        //歌词同步
        for(var i=0;i<$("#lrc li").length;i++){
            if(parseInt(Math.ceil(omyaudio.currentTime))==$("#lrc li:eq("+i+")").attr("data-time")){
                $("#lrc li:eq("+(i-1)+")").css("color", "black");
                $("#lrc li:eq("+i+")").css("color", "white");
                $("#showlyric").html($("#lrc li:eq("+i+")").html());
                //滚动条滚动
                for(var j=0;j<lrcs.length;j++){
                    if(data[activeNum].lyric==lrcs[j].song){
                        for(var k=0;k<lrcs[j].lyric.length;k++) {
                            if(lrcs[j].lyric[k].time==$("#lrc li:eq("+j+")").attr("data-time")){
                                $("#lrc").scrollTop(30*i);
                            }
                        }
                    }
                }
            }
        }
    }

    //鼠标点击改变歌词进度，本地的歌曲不适应，线上的可以比如换成url=http://music.163.com/song/media/outer/url?id=513360721.mp3可以
    onow.onmouseup=function (ev) {
        var pro=ev.offsetX/onow.offsetWidth;
        var w=pro*(onow.offsetWidth-16);
        $("#curtime").css("width",w);
        $("#curall").css("left",w);
        omyaudio.currentTime=pro*omyaudio.duration;
    };

    //加载完成事件
    omyaudio.oncanplay=function() {
        var m = timeChange(parseInt(Math.ceil(omyaudio.duration)/60));
        var s = timeChange(parseInt(Math.ceil(omyaudio.duration)%60));
        var t = m+":"+s;
        document.getElementById("a_end").innerText=t;
    };

    //时间格式处理
    function timeChange(num) {
        var t;
        if(num<10) {
            t="0"+num;
        } else {
            t=num;
        }
        return t;
    }

    //音量控制
    $("#color_voice").click(function() {
        var v=$("#volume").val();
        if(v==0) {
            $("#volume")[0].value =0.2;
        } else {
            $("#volume")[0].value =0;
        }
        chooseVolume();
    });

    function chooseVolume() {
        omyaudio.volume=$("#volume").val();
        if($("#volume").val()==0) {
            $("#color_voice").removeClass("fa fa-bell-o fa-1g color_voice");
            $("#color_voice").addClass("fa fa-bell-slash-o fa-1g color_voice");
        } else {
            $("#color_voice").removeClass("fa fa-bell-slash-o fa-1g color_voice");
            $("#color_voice").addClass("fa fa-bell-o fa-1g color_voice");
        }
    }

    //展示评论
    function getMessage(){
        $("#msg").html("");
        for(var i=0;i<data.length;i++){
            if(activeNum==i){
                //alert(data[i].msg.length);
                $("#sum b:eq(0)").text(data[i].msg.length);
                $("#f_dl h3").html("歌曲："+data[i].song)
                for(var j=0;j<data[i].msg.length;j++){
                    var con=data[i].msg[j].megCon;
                    var date=data[i].msg[j].date;
                    var userId=data[i].msg[j].userId;
                    for(var k=0;k<users.length;k++){
                        if(userId==users[k].id){
                            var name=users[k].name;
                            var pic=users[k].pic;
                            $("#msg").append("<li><img src='"+pic+"' alt='用户图像'><span class='zh'><b>"+name+"：</b>"+con+"<br/><label>"+date+"<span class='fa fa-thumbs-o-up fa-1g dian'>点赞|分享|回复</span></label></span><div class='clear'></div></li>");
                        }
                    }
                }
            }
        }
    }

    function putComment(){
        $("#f_dl").toggle();
    }

    $("#f_hide").click(function() {
        $("#f_dl").hide();
    });

    //发表评论
    $("#f_pl").click(function() {
        var con=$("textarea").val();
        if($("#h_login").text()=="登录"){
            alert("请登录后再发表评论！");
        } else if(con==""){
            alert("请输入评论内容！");
        } else{
            var date = new Date();
            var y = date.getFullYear();
            var m = timeChange(date.getMonth()+1);
            var d = timeChange(date.getDate());
            var h = timeChange(date.getHours());
            var i = timeChange(date.getMinutes());
            var s = timeChange(date.getSeconds());
            var t = y+"-"+m+"-"+d+" "+h+":"+i+":"+s;
            var userId="";
            for(var i=0;i<users.length;i++){
                if(activeUser==i){
                    userId=users[i].id;
                }
            }
            var megId="";
            for(var j=0;j<data.length;j++){
                if(activeNum==j){
                    megId=data[j].msg.length+1;
                }
            }

            var str = "megId="+megId+"&con="+con+"&date="+t+"&userId="+userId;
            //异步登录
            var url= "http://www.coolneng.com/form/?"+str;
            xmlhttp.onreadystatechange=function() {
                //判断当前的状态
                console.log("监听：",xmlhttp.readyState,xmlhttp.status);
                //判断异步请求的准备状态，及网络状态
                if(xmlhttp.readyState==4 && xmlhttp.status==200){
                    //回调数据，转化为JSON格式
                    var formjson=JSON.parse(xmlhttp.responseText);

                    if(formjson.content==false) {
                        alert("用户提交的是一个空数据");
                    } else {
                        //添加进数组
                        for(var v=0;v<data.length;v++){
                            if(activeNum==v) {
                                var arr = {
                                    "megId" : formjson.content.megId,
                                    "megCon" : formjson.content.con,
                                    "date" : formjson.content.date,
                                    "userId" : formjson.content.userId
                                }
                                console.log(arr);
                                data[v].msg.push(arr);
                                console.log(data[v].msg);
                                $("#f_dl").hide();
                                getMessage();
                            }
                        }
                    }
                }
            }
            //数据传输  第三个参数 如果是TRUE异步
            xmlhttp.open("POST",url,true);
            //请求头
            xmlhttp.setRequestHeader("content-Type","application/x-www-form-urlencoded");
            // 发送请求
            xmlhttp.send(url);
        }

    });

    $("#myload").click(function(){
        omyaudio.progress();
    });

    //上一首
    $("#preplay").click(function(){
        preplay();
    });

    function preplay() {
        notPlay = 0;
        var m = $("#mode")[0].className;
        //顺序播放
        if(m=="fa fa-reorder (alias) fa-1g mode"){
            if(activeNum-1<0){
                activeNum = data.length-1;

            }else {
                activeNum = activeNum - 1;
            }
            omyaudio.src=data[activeNum].url;
            playMusic();
        }
        //循环播放，也就是列表播放
        else if (m=="fa fa-recycle fa-1g mode") {
            if(activeNum-1<0){
                activeNum = data.length-1;

            }else {
                activeNum = activeNum - 1;
            }
            omyaudio.src=data[activeNum].url;
            playMusic();
        }
        //单曲循环
        else if (m=="fa fa-refresh fa-1g mode") {
            if(activeNum-1<0){
                activeNum = data.length-1;

            }else {
                activeNum = activeNum - 1;
            }
            omyaudio.src=data[activeNum].url;
            playMusic();
        }
        //随机播放
        else if (m=="fa fa-random fa-1g mode") {
            activeNum = randomnum();
            omyaudio.src=data[activeNum].url;
            playMusic();
        }
    }

    //下一首
    $("#nextplay").click(function(){
        nextplay();
    });

    function nextplay() {
        notPlay = 0;
        var m = $("#mode")[0].className;
        //单曲循环
        if (m=="fa fa-refresh fa-1g mode") {
            if(data.length-1==activeNum){
                activeNum=0;
            }else{
                activeNum=activeNum+1;
            }
            omyaudio.src=data[activeNum].url;
            playMusic();
        } else {
            modePlay(m);
        }
    }

    //播放模式
    function modePlay(res) {
        //顺序播放
        if(res=="fa fa-reorder (alias) fa-1g mode"){
            if(data.length-1==activeNum){
                $("#myplay").removeClass("fa fa-pause-circle-o fa-2x play");
                $("#myplay").addClass("fa fa-play-circle fa-2x play");
                nowPause();
                stopXz();
            }else{
                activeNum=activeNum+1;
                omyaudio.src=data[activeNum].url;
                playMusic();
            }
        }
        //循环播放，也就是列表播放
        else if (res=="fa fa-recycle fa-1g mode") {
            if(data.length-1==activeNum){
                activeNum=0;
            }else{
                activeNum=activeNum+1;
            }
            omyaudio.src=data[activeNum].url;
            playMusic();
        }
        //随机播放
        else if (res=="fa fa-random fa-1g mode") {
            activeNum = randomnum();
            omyaudio.src=data[activeNum].url;
            playMusic();
        }
    }
    //播放模式样式更改
    $("#mode").click(function(){
        var m = $("#mode")[0].className;
        if(m=="fa fa-reorder (alias) fa-1g mode"){
            $(this).removeClass(m);
            $(this).addClass("fa fa-recycle fa-1g mode");
            $("#mode")[0].title="循环播放";
        }
        if(m=="fa fa-recycle fa-1g mode"){
            $(this).removeClass(m);
            $(this).addClass("fa fa-refresh fa-1g mode");
            $("#mode")[0].title="单曲循环";
        }
        if(m=="fa fa-refresh fa-1g mode"){
            $(this).removeClass(m);
            $(this).addClass("fa fa-random fa-1g mode");
            $("#mode")[0].title="随机播放";
        }
        if(m=="fa fa-random fa-1g mode"){
            $(this).removeClass(m);
            $(this).addClass("fa fa-reorder (alias) fa-1g mode");
            $("#mode")[0].title="顺序播放";
        }
    });

    //播放完成事件
    omyaudio.onended=function () {
        notPlay = 0;
        var m = $("#mode")[0].className;
        //单曲循环
        if (m=="fa fa-refresh fa-1g mode") {
            //notPlay = 1;
            //omyaudio.loop = true;
            playMusic();
        } else {
            modePlay(m);
        }
    };

    function randomnum() {
        var r=parseInt(Math.random()*data.length);
        while(r==activeNum){
            r=parseInt(Math.random()*data.length);
        }
        return r;
    }

    $("#mylyric").click(function(){
        $("#showlyric").toggle();

    });

    var oshow=$("#show")[0].getElementsByTagName("span");
    var ocon=$("#s")[0].getElementsByTagName("div");

    var otmp=0;
    function choosedd(num) {
        ocon[otmp].style.display="none";
        oshow[otmp].style.background="#ffffff";
        ocon[num].style.display="block";
        oshow[num].style.background="#a8a8a8";
        otmp=num;
    }

    for(var i=0;i<oshow.length;i++) {
        oshow[i].flag=i;
        oshow[i].onclick=function () {
            choosedd(this.flag);
        }
    }

    $("#mylist").click(function(){
        $("#showlist").toggle();
        getcookie();
    });

    //设置cookie
    function setcookie(name,value,playday) {
        var odate=new Date(); //定义一个时间函数
        odate.setDate(odate.getDate()+playday); //获取当前的天数+保存的天数
        document.cookie=name+"="+value+";expires="+odate; //保存COOKIE
    }

    var hisData = [];
    function getcookie() {
        hisData = [];
        $("#history ul").html("");
        if(document.cookie.length>0) {
            var arr = document.cookie.split(";");
            for(var item in arr) {
                var arr0 = arr[item].split("=");
                var r = {
                    "song" : arr0[0],
                    "singer" : arr0[1]
                }
                hisData.push(r);
            }
        }
        for(var i=0; i<hisData.length; i++) {
            $("#history ul").append("<li onclick='hisPlay("+i+")'>"+hisData[i].song+"&nbsp;"+hisData[i].singer+"</li>");
        }
        $("#history b").text(hisData.length);
    }

    $("#oclear_2").click(function(){
        for(var i=0; i<hisData.length; i++) {
            setcookie(hisData[i].song.trim(), "", -1);
        }
        getcookie();
    });

    var thisData = data;
    function oplaylist() {
        console.log(thisData)
        $("#play ul").html("");
        for(var i=0; i<thisData.length; i++) {
            $("#play ul").append("<li onclick='thisPlay("+i+")'>"+thisData[i].song+"&nbsp;"+thisData[i].singer+"</li>");
        }
        $("#play b").text(thisData.length);
        $("#dig").html(thisData.length);
    }

    $("#oclear_1").click(function(){
        thisData = [];
        oplaylist();
    });

    $(function(){
        startMusic();
        choosedd(0);
        oplaylist();
        $("#dig").html(thisData.length);
    });

    function chageStyle() {
        for(var i=0; i<data.length; i++) {
            if(data[activeNum].song==data[i].song) {
                $("#play ul li:eq("+i+")").css("background", "yellow");
            } else {
                $("#play ul li:eq("+i+")").css("background", "#F8F8F8");
            }
        }
    }

    function thisPlay(res) {
        for(var i=0; i<data.length; i++){
            if(thisData[res].song==data[i].song) {
                activeNum = i;
            }
        }
        omyaudio.src=data[activeNum].url;
        notPlay = 0;
        playMusic();
    }
    function hisPlay(res) {
        for(var i=0; i<data.length; i++){
            if(hisData[res].song.trim()==data[i].song) {
                activeNum = i;
            }
        }
        omyaudio.src=data[activeNum].url;
        notPlay = 0;
        playMusic();
    }
</script>
</html>